function Banners(){}Banners.prototype.listenAddBanners=function(){var t=this;$("#add-banner-btn").click(function(){var n=$(".banner-list-group");if(3<=n.children().length)window.messageBox.showInfo("最多只能添加3张轮播图！");else{var a=template("banner-item");n.prepend(a);var e=n.find(".banner-item:first");t.addImgSelectEvent(e),t.addRemoveBannerEvent(e),t.addSaveBannerEvent(e)}})},Banners.prototype.addImgSelectEvent=function(n){var e=n.find(".thumbnail"),a=n.find(".image-input");e.click(function(){$(this);a.click()}),a.change(function(){var n=this.files[0],a=new FormData;a.append("file",n),xfzajax.post({url:"/cms/upload_file/",data:a,processData:!1,contentType:!1,success:function(n){if(200===n.code){var a=n.data.url;e.attr("src",a)}}})})},Banners.prototype.addRemoveBannerEvent=function(a){$(".close-btn").click(function(){var n=a.attr("data-banner-id");n?xfzalert.alertConfirm({text:"您确定要删除这个轮播图吗？",confirmCallback:function(){xfzajax.post({url:"/cms/delete_banner/",data:{banner_id:n},success:function(n){200===n.code&&(a.remove(),window.messageBox.showSuccess("轮播图删除成功!"))}})}}):a.remove()})},Banners.prototype.addSaveBannerEvent=function(t){var n=t.find(".save-btn"),r=t.find(".thumbnail"),i=t.find("input[name='priority']"),o=t.find("input[name='link_to']"),s=t.find("span[class='priority']"),d=t.attr("data-banner-id"),c="";c=d?"/cms/edit_banner/":"/cms/add_banner/",n.click(function(){var n=r.attr("src"),a=i.val(),e=o.val();xfzajax.post({url:c,data:{pk:d,image_url:n,priority:a,link_to:e},success:function(n){if(200===n.code){d?window.messageBox.showSuccess("轮播图修改成功"):(d=n.data.banner_id,t.attr("data-banner-id",d),window.messageBox.showSuccess("轮播图添加完成!"));var a=n.data.priority;s.text("优先级: "+a)}}})})},Banners.prototype.loadData=function(){var s=this;xfzajax.get({url:"/cms/banner_list/",success:function(n){if(200===n.code)for(var a=n.data,e=0;e<a.length;e++){var t=a[e],r=template("banner-item",{banner:t}),i=$(".banner-list-group");i.append(r);var o=i.find(".banner-item:last");s.addImgSelectEvent(o),s.addRemoveBannerEvent(o),s.addSaveBannerEvent(o)}}})},Banners.prototype.run=function(){this.listenAddBanners(),this.loadData()},$(function(){(new Banners).run()});