function News(){}News.prototype.run=function(){var e=this;e.listenQiniuUploadEvent(),e.initUedior(),e.listenSubmitEvent()},News.prototype.listenSubmitEvent=function(){$("#submit-btn").click(function(e){e.preventDefault();var t=$(this).attr("data-news-id");url=t?"/cms/edit_news/":"/cms/write_news/";var n=$("input[name='title']").val(),o=$("select[name='category']").val(),i=$("input[name='desc']").val(),a=$("input[name='thumbnail']").val(),r=window.ue.getContent();xfzajax.post({url:url,data:{title:n,category:o,desc:i,thumbnail:a,context:r,pk:t},success:function(e){200===e.code&&xfzalert.alertSuccess("恭喜！新闻发表成功",function(){window.location.reload()})}})})},News.prototype.listenUploadFileEvent=function(){var n=$("#upload-btn");n.change(function(){var e=n[0].files[0],t=new FormData;t.append("file",e),xfzajax.post({url:"/cms/upload_file/",data:t,processData:!1,contentType:!1,success:function(e){if(200===e.code){var t=e.data.url;$("#thumbnail-form").val(t)}}})})},News.prototype.listenQiniuUploadEvent=function(){var r=this;$("#upload-btn").change(function(){var a=this.files[0];xfzajax.get({url:"/cms/qntoken/",success:function(e){if(200===e.code){var t=e.data.token,n=(new Date).getTime()+"."+a.name.split(".")[1],o={fname:n,params:{},mimeType:["image/png","image/jpeg","image/gif"]},i={useCdnDomain:!0,retryCount:6,region:qiniu.region.z2};qiniu.upload(a,n,t,o,i).subscribe({next:r.handleFileUploadProgress,error:r.handleFileUploadError,complete:r.handleFileUploadComplete})}}})})},News.prototype.handleFileUploadComplete=function(e){console.log(e),$("#progress-group").hide(),$(".progress-bar").css({width:0});var t="http://pyc1lgciv.bkt.clouddn.com/"+e.key;$("input[name='thumbnail']").val(t)},News.prototype.handleFileUploadError=function(e){window.messageBox.showError(e),console.log(e),$("#progress-group").hide()},News.prototype.handleFileUploadProgress=function(e){var t=e.total.percent.toFixed(0)+"%";$("#progress-group").show();var n=$(".progress-bar");n.css({width:t}),n.text(t)},News.prototype.initUedior=function(){window.ue=UE.getEditor("editor",{initialFrameHeight:300,serverUrl:"/ueditor/upload/"})},$(function(){(new News).run()});